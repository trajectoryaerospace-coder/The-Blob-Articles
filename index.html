<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Editor</title>
    <script src="https://unpkg.com/pdf-lib@1.17.0/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/@pdf-lib/fontkit@0.0.4/dist/fontkit.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4">PDF Editor</h1>
        <div class="mb-4">
            <input type="file" id="pdfInput" accept="application/pdf" class="mb-2">
            <button id="loadPdf" class="bg-blue-500 text-white px-4 py-2 rounded">Load PDF</button>
        </div>
        <div class="flex">
            <div class="w-1/4 p-4 bg-white rounded shadow">
                <h2 class="text-lg font-semibold mb-2">Tools</h2>
                <button id="addText" class="bg-green-500 text-white px-4 py-2 rounded mb-2 w-full">Add Text</button>
                <button id="addImage" class="bg-green-500 text-white px-4 py-2 rounded mb-2 w-full">Add Image</button>
                <button id="drawRect" class="bg-green-500 text-white px-4 py-2 rounded mb-2 w-full">Draw Rectangle</button>
                <button id="addPage" class="bg-purple-500 text-white px-4 py-2 rounded mb-2 w-full">Add Page</button>
                <button id="deletePage" class="bg-red-500 text-white px-4 py-2 rounded mb-2 w-full">Delete Current Page</button>
                <button id="savePdf" class="bg-blue-500 text-white px-4 py-2 rounded w-full">Save PDF</button>
                <div class="mt-4">
                    <label class="block">Text Content:</label>
                    <input type="text" id="textContent" class="border p-2 w-full" placeholder="Enter text">
                    <label class="block mt-2">Font Size:</label>
                    <input type="number" id="fontSize" class="border p-2 w-full" value="12">
                    <label class="block mt-2">Page Number:</label>
                    <input type="number" id="pageNumber" class="border p-2 w-full" value="1" min="1">
                </div>
                <div id="imageInput" class="hidden mt-4">
                    <label class="block">Upload Image:</label>
                    <input type="file" id="imageFile" accept="image/*" class="border p-2 w-full">
                </div>
            </div>
            <div class="w-3/4 p-4">
                <canvas id="pdfCanvas" class="border bg-white"></canvas>
                <div class="mt-4">
                    <button id="prevPage" class="bg-gray-500 text-white px-4 py-2 rounded">Previous Page</button>
                    <span id="pageInfo" class="mx-4">Page 1 of 1</span>
                    <button id="nextPage" class="bg-gray-500 text-white px-4 py-2 rounded">Next Page</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        let pdfDoc = null;
        let currentPage = 1;
        let totalPages = 1;
        const canvas = document.getElementById('pdfCanvas');
        const ctx = canvas.getContext('2d');

        async function loadPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
            totalPages = pdfDoc.getPageCount();
            currentPage = 1;
            updatePageInfo();
            renderPage(currentPage);
        }

        async function renderPage(pageNum) {
            const page = pdfDoc.getPage(pageNum - 1);
            const { width, height } = page.getSize();
            canvas.width = width;
            canvas.height = height;

            const pdfBytes = await pdfDoc.save();
            const pdfDataUri = await new Promise(resolve => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.readAsDataURL(new Blob([pdfBytes], { type: 'application/pdf' }));
            });

            const img = new Image();
            img.src = pdfDataUri;
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            };
        }

        async function addTextToPDF() {
            const text = document.getElementById('textContent').value;
            const fontSize = parseInt(document.getElementById('fontSize').value);
            const pageNum = parseInt(document.getElementById('pageNumber').value);
            if (!text || pageNum < 1 || pageNum > totalPages) return;

            const page = pdfDoc.getPage(pageNum - 1);
            const font = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);
            page.drawText(text, {
                x: 50,
                y: page.getHeight() - 50,
                size: fontSize,
                font: font,
                color: PDFLib.rgb(0, 0, 0),
            });
            renderPage(currentPage);
        }

        async function addImageToPDF(file) {
            const pageNum = parseInt(document.getElementById('pageNumber').value);
            if (pageNum < 1 || pageNum > totalPages) return;

            const arrayBuffer = await file.arrayBuffer();
            const imgType = file.type === 'image/png' ? 'png' : 'jpeg';
            const img = imgType === 'png' ? await pdfDoc.embedPng(arrayBuffer) : await pdfDoc.embedJpg(arrayBuffer);
            const page = pdfDoc.getPage(pageNum - 1);
            const { width, height } = img.scale(0.5);
            page.drawImage(img, {
                x: 50,
                y: page.getHeight() - height - 50,
                width: width,
                height: height,
            });
            renderPage(currentPage);
        }

        function drawRectangle() {
            const pageNum = parseInt(document.getElementById('pageNumber').value);
            if (pageNum < 1 || pageNum > totalPages) return;

            const page = pdfDoc.getPage(pageNum - 1);
            page.drawRectangle({
                x: 100,
                y: page.getHeight() - 200,
                width: 100,
                height: 50,
                borderWidth: 2,
                borderColor: PDFLib.rgb(1, 0, 0),
                color: PDFLib.rgb(0, 1, 0),
                opacity: 0.5,
            });
            renderPage(currentPage);
        }

        async function addNewPage() {
            pdfDoc.addPage();
            totalPages = pdfDoc.getPageCount();
            currentPage = totalPages;
            updatePageInfo();
            renderPage(currentPage);
        }

        async function deleteCurrentPage() {
            if (totalPages <= 1) return;
            pdfDoc.removePage(currentPage - 1);
            totalPages = pdfDoc.getPageCount();
            if (currentPage > totalPages) currentPage = totalPages;
            updatePageInfo();
            renderPage(currentPage);
        }

        async function savePDF() {
            const pdfBytes = await pdfDoc.save();
            const blob = new Blob([pdfBytes], { type: 'application/pdf' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'edited_pdf.pdf';
            link.click();
        }

        function updatePageInfo() {
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('pageNumber').max = totalPages;
        }

        document.getElementById('loadPdf').addEventListener('click', () => {
            const file = document.getElementById('pdfInput').files[0];
            if (file) loadPDF(file);
        });

        document.getElementById('addText').addEventListener('click', addTextToPDF);
        document.getElementById('addImage').addEventListener('click', () => {
            document.getElementById('imageInput').classList.toggle('hidden');
        });
        document.getElementById('imageFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) addImageToPDF(file);
        });
        document.getElementById('drawRect').addEventListener('click', drawRectangle);
        document.getElementById('addPage').addEventListener('click', addNewPage);
        document.getElementById('deletePage').addEventListener('click', deleteCurrentPage);
        document.getElementById('savePdf').addEventListener('click', savePDF);
        document.getElementById('prevPage').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                updatePageInfo();
                renderPage(currentPage);
            }
        });
        document.getElementById('nextPage').addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                updatePageInfo();
                renderPage(currentPage);
            }
        });
    </script>
</body>
</html>
